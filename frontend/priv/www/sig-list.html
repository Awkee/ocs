<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/iron-icons/notification-icons.html">
<link rel="import" href="bower_components/iron-icons/editor-icons.html">
<link rel="import" href="bower_components/iron-icon/iron-icon.html">
<link rel="import" href="bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="shared-styles.html">


<dom-module id="sig-list">

		  <template>
					 <style> /* local DOM styles go here */ 
:host { display: inline-block; }
iron-icon { fill: rgba(0,0,0,0); stroke: currentcolor; } 
:host([pressed]) iron-icon { fill: currentcolor; }
paper-button{   
		  background-color: #7d8ff5;
		  color: white;
		  font-weight: bold;}

								#subscriber{width:3%;}
					 </style>
					 <div>	
								<paper-toolbar>
										  <img id="subscriber" src="list.png">
										  <div hidden$="{{hide}}">
													 <paper-button toggles  style="float: right; width: 200px;}" > Edit </paper-button>
													 <paper-button toggles raised on-click = "deleteSeletedItems" style="float: right; width: 200px;}" > Delete </paper-button>
										  </div>
										  <paper-button toggles raised on-click = "gotoEnd" style="float: right; width: 200px;}"  >
													 Scroll to bottom
										  </paper-button>
								</paper-toolbar>
					 </div>
					 <style include="shared-styles">
:host {
		  display: block;
		  padding: 10px;
}
						vaadin-grid{font-size: 16px;}
					 </style>

					 <iron-ajax id="getSubs"
					 				auto=true
									url="http://localhost:8888/ocs/subscriber"
									headers='{"Accept": "application/json"}'
									on-response="responseHandler"
									debounce-duration="10">
					 </iron-ajax>

					 <vaadin-grid selection-mode="multi" id="frozen" frozen-columns="2" on-selected-items-changed="onSelect">
								<table>
										  <colgroup> 
													 <col name="identity"/> 
													 <col name="password"/> 
													 <col name="attributes"/> 
													 <col name="enabled"/> 
										  </colgroup>
										  <thead>
													 <tr>
																<th>Subscriber</th>
																<th>Password</th>
																<th>Attributes</th>
																<th>Enabled</th>
													 </tr>
										  </thead>
								</table>

					 </vaadin-grid>
					 <iron-ajax	 id="deleteSubs"
									 auto
									 handle-as="json"
			 						 method = "delete"
									 on-response="deletionResponse"
									 debounce-duration="300"></iron-ajax>

		  </template>
		  <script>
Polymer({
		  is: 'sig-list',

		  properties:{
					 hide:{type: Boolean, value: true}
		  },
			
		  created: function() {
		  },

		  ready: function() {
		  },

		  responseHandler: function(event) {
					 var grid = this.$.frozen; 
					 grid.items = event.detail.xhr.response;
		  },

		  gotoEnd: function(event){
					 var grid = this.$.frozen; 
					 grid.scrollToEnd();
		  },

		  deleteSeletedItems: function(event){
					 var grid = this.$.frozen; 
					 grid.selection.selected(function(index)
										  { var selection = grid.items[index];
											 var deleteAjax = document.getElementById("deleteSubs");
											 deleteAjax.url = "http://localhost:8888/ocs/subscriber/"+ selection.identity;
											 deleteAjax.generateRequest();
										  });
		  },

		  deletionResponse: function(event){
					 var getSubsAjax = document.getElementById("getSubs");
					 getSubsAjax.generateRequest();
		  },

		  onSelect: function(event) {
					 this.hide = false;
		  }
});
		  </script>
</dom-module>
