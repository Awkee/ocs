<!--  vim: ts=3  -->
<link rel="import" href="polymer/polymer.html">
<link rel="import" href="i18n-msg/i18n-msg.html">
<link rel="import" href="i18n-msg/i18n-msg-behavior.html">
<link rel="import" href="iron-ajax/iron-ajax.html">
<link rel="import" href="iron-collapse/iron-collapse.html">
<link rel="import" href="paper-dialog/paper-dialog.html">
<link rel="import" href="paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="paper-listbox/paper-listbox.html">
<link rel="import" href="paper-toolbar/paper-toolbar.html">
<link rel="import" href="paper-input/paper-input.html">
<link rel="import" href="paper-button/paper-button.html">
<link rel="import" href="paper-tooltip/paper-tooltip.html">
<link rel="import" href="paper-toggle-button/paper-toggle-button.html" >
<link rel="import" href="paper-toast/paper-toast.html">
<link rel="import" href="paper-styles/color.html">
<link rel="import" href="paper-date-picker/paper-date-picker.html">

<dom-module id="sig-pro-add">
	<style is="custom-style">
		paper-dialog {
			overflow: auto;
		}
		paper-item {
			padding-right: 10px;
		}
		paper-toolbar{
			margin-top: 0px;
			color: white;
			background-color: #bc5100;
		}
		paper-toast.error {
			background-color: var(--paper-red-a400);
		}
		.add-button {
			background-color: var(--paper-lime-a700);
			color: black;
			width: 8em;
		}
		.cancel-button {
			color: black;
		}
		.close {
			background-color: var(--paper-lime-a700);
			color: black;
			float: right;
			width: 5em;
		}
	</style>
	<template>
		<paper-dialog id="addProductModal" modal>
			<paper-toolbar>
				<paper-tabs selected="{{selected}}">
					<paper-tab id="offer-add">
						<h2>[[i18n.offer]]</h2>
					</paper-tab>
					<paper-tab id="price-add">
						<h2>[[i18n.prices]]</h2>
					</paper-tab>
					<paper-tab id="alt-add">
						<h2>[[i18n.alter]]</h2>
					</paper-tab>
				</paper-tabs>
			</paper-toolbar>
			<iron-pages selected="{{selected}}">
			<div id="addOff-tab">
				<div>
					<paper-input id="addOff1"
							class="name"
							name="name"
							label="[[i18n.name]]"
							onfocus="endDatePickOff.hide(); startDatePickOff.hide();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="offerNameTool">
							Product Offering name
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<paper-input id="addOff2"
							class="description"
							name="description"
							label="[[i18n.des]]"
							onfocus="endDatePickOff.hide(); startDatePickOff.hide();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="offerDesTool">
							Product Offering description
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<iron-collapse id="startDatePickOff">
						<paper-date-picker id="startOff3" date="{{pickstart}}">
						</paper-date-picker>
					</iron-collapse>
					<paper-input id="addOff3"
							value="[[startDateOffer]]"
							name="startDateOffer"
							label="[[i18n.start]]"
							onfocus="endDatePickOff.hide(); startDatePickOff.show();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="offerStartTool">
							Product Offering start date
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<iron-collapse id="endDatePickOff">
						<paper-date-picker id="endOff3" date="{{pickend}}">
						</paper-date-picker>
					</iron-collapse>
					<paper-input id="addOff4"
							value="[[endDateOffer]]"
							name="endDateOffer"
							label="[[i18n.end]]"
							onfocus="startDatePickOff.hide(); endDatePickOff.show();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="offerEndTool">
							Product Offering end date
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div class="buttons">
					<paper-button dialog-confirm raised
							class="add-button"
							on-tap="addOffer">
							<i18n-msg msgid="submit">
								Submit
							</i18n-msg>
					</paper-button>
					<paper-button dialog-dismiss
							class="cancel-button"
							onclick="addProductModal.close()">
							<i18n-msg msgid="cancel">
								cancel
							</i18n-msg>
					</paper-button>
				</div>
			</div>
			<div id=addPrice-tab>
				<div>
					<datalist id="price">
						<template is="dom-repeat" items="[[prices]]">
							<option value="{{item.name}}" />
						</template>
					</datalist>
					<paper-input id="priceName" 
							list="price"
							label="[[i18n.name]]"
							on-change="updatePriceDialog"
							onfocus="endDatePickPrice.hide(); startDatePickPrice.hide();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="priceNameTool">
							Product offering price name
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<paper-input id="addPriceDes"
							class="description"
							name="description"
							label="[[i18n.des]]"
							onfocus="endDatePickPrice.hide(); startDatePickPrice.hide();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="priceDesTool">
							Product Offering price description
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<iron-collapse id="startDatePickPrice">
						<paper-date-picker id="addPriceStart" date="{{pickstart}}" headingFormat="dd, MMM D">
						</paper-date-picker>
					</iron-collapse>
					<paper-input id="priceStartDate"
							value="[[startDatePrice]]"
							name="startDatePrice"
							label="[[i18n.start]]"
							onfocus="endDatePickPrice.hide(); startDatePickPrice.show();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="priceStartTool">
							Product Offering price start date
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<iron-collapse id="endDatePickPrice">
						<paper-date-picker id="addPriceEnd" date="{{pickend}}">
						</paper-date-picker>
					</iron-collapse>
					<paper-input id="priceEndDate"
							value="[[endDatePrice]]"
							name="endDatePrice"
							label="[[i18n.end]]"
							onfocus="startDatePickPrice.hide(); endDatePickPrice.show();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="priceEndTool">
							Product offering price end date
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<paper-dropdown-menu id="addPrice1drop"
							label="[[i18n.priceType]]"
							on-selected-item-changed="checkRecure"
							onfocus="endDatePickPrice.hide(); startDatePickPrice.hide();">
						<paper-listbox
								id="addPrice1"
								slot="dropdown-content"
								class="dropdown-content"
								selected="2">
							<paper-item>
								Recurring
							</paper-item>
							<paper-item>
								One Time
							</paper-item>
							<paper-item>
								Usage
							</paper-item>
						</paper-listbox>
					</paper-dropdown-menu>
					<paper-tooltip>
						<i18n-msg msgid="priceTypeTool">
							Product offering type of price
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<paper-input id="addPriceSize"
							class="size"
							name="size"
							type="text"
							allowed-pattern="[0-9kmg]"
							pattern="^[0-9]+[kmg]?$"
							label="[[i18n.unitSize]]"
							auto-validate
							value=1
							onfocus="endDatePickPrice.hide(); startDatePickPrice.hide();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="priceSizeTool">
							Product offering price unit size
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<paper-dropdown-menu id="addPrice2drop"
							label="[[i18n.unit]]"
							on-selected-item-changed="checkPattern"
							onfocus="endDatePickPrice.hide(); startDatePickPrice.hide();">
						<paper-listbox
								id="addPrice2"
								slot="dropdown-content"
								class="dropdown-content">
							<paper-item id="priceBytes">
								Bytes
							</paper-item>
							<paper-item id="priceCents">
								Cents
							</paper-item>
							<paper-item id="priceSeconds">
								Seconds
							</paper-item>
						</paper-listbox>
					</paper-dropdown-menu>
					<paper-tooltip>
						<i18n-msg msgid="priceUnitTool">
							Product offering price units
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<paper-input id="addPrice3"
							class="amount"
							name="amount"
							type="number"
							label="[[i18n.amount]]"
							value=0
							onfocus="endDatePickPrice.hide(); startDatePickPrice.hide();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="priceAmountTool">
							Product offering price amount
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<paper-input id="addPrice4"
							class="currency"
							name="currency"
							label="[[i18n.currency]]"
							onfocus="endDatePickPrice.hide(); startDatePickPrice.hide();">
					</paper-input>
					<paper-tooltip>
						<i18n-msg msgid="priceCurrencyTool">
							Product offering price currency
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<paper-dropdown-menu id="addPrice5drop"
							label="[[i18n.period]]"
							onfocus="endDatePickPrice.hide(); startDatePickPrice.hide();">
						<paper-listbox
								id="addPrice5"
								slot="dropdown-content"
								class="dropdown-content"
								selected="2">
							<paper-item>
								Daily
							</paper-item>
							<paper-item>
								Weekly
							</paper-item>
							<paper-item>
								Monthly
							</paper-item>
							<paper-item>
								Yearly
							</paper-item>
						</paper-listbox>
					</paper-dropdown-menu>
					<paper-tooltip>
						<i18n-msg msgid="pricePeriodTool">
							Product offering price period
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div>
					<paper-dropdown-menu
							id="addPriceDrop"
							label="[[i18n.alter]]"
							onfocus="endDatePickPrice.hide(); startDatePickPrice.hide();">
						<paper-listbox
								slot="dropdown-content"
								class="dropdown-content">
								<template is="dom-repeat" items="[[alterations]]">
									<paper-item>
										{{item.name}}
									</paper-item>
								</template>
						</paper-listbox>
					</paper-dropdown-menu>
					<paper-tooltip>
						<i18n-msg msgid="priceAlterTool">
							add alteration to product offering price
						</i18n-msg>
					</paper-tooltip>
				</div>
				<div class="buttons">
					<paper-button raised
							class="add-button"
							on-tap="addPrice">
							<i18n-msg msgid="add">
								Add
							</i18n-msg>
					</paper-button>
					<paper-button dialog-dismiss
							class="cancel-button"
							onclick="addProductModal.close()">
							<i18n-msg msgid="cancel">
								cancel
							</i18n-msg>
					</paper-button>
				</div>
			</div>
			<div id="add-Alt-tab">
				<div>
					<datalist id="alts">
						<template is="dom-repeat" items="[[alterations]]">
							<option value="{{item.name}}" />
						</template>
					</datalist>
					<paper-input id="addAlt1" 
							list="alts" 
							label="[[i18n.name]]" 
							on-change="updateAltsDialog">
					</paper-input>
					<paper-tooltip>
							product offering alteration name
					</paper-tooltip>
				</div>
				<div>
					<paper-input id="descAlt2"
							class="description"
							name="description"
							label="[[i18n.des]]"
							onfocus="endDatePick.hide(); startDatePick.hide();">
					</paper-input>
					<paper-tooltip>
							product offering alteration description
					</paper-tooltip>
				</div>
				<div>
					<iron-collapse id="startDatePick">
						<paper-date-picker id="startAlt3" date="{{pickstart}}">
						</paper-date-picker>
					</iron-collapse>
					<paper-input id="startAlt2"
							value="[[startdate]]"
							name="startdate"
							label="[[i18n.start]]"
							onfocus="endDatePick.hide(); startDatePick.show();">
					</paper-input>
					<paper-tooltip>
							product offering alteration start date
					</paper-tooltip>
				</div>
				<div>
					<iron-collapse id="endDatePick">
						<paper-date-picker id="endAlt3" date="{{pickend}}">
						</paper-date-picker>
					</iron-collapse>
					<paper-input id="endAlt2"
							value="{{enddate}}"
							name="terminationDate"
							label="[[i18n.end]]"
							onfocus="startDatePick.hide(); endDatePick.show();">
					</paper-input>
					<paper-tooltip>
							product offering alteration end date
					</paper-tooltip>
				</div>
				<div>
					<paper-dropdown-menu
							label="[[i18n.priceType]]"
							on-selected-item-changed="checkRecureAlt"
							onfocus="endDatePick.hide(); startDatePick.hide();">
						<paper-listbox
								id="typeAlt3"
								slot="dropdown-content"
								class="dropdown-content"
								selected="2">
							<paper-item>
								Recurring
							</paper-item>
							<paper-item>
								One Time
							</paper-item>
							<paper-item>
								Usage
							</paper-item>
						</paper-listbox>
					</paper-dropdown-menu>
					<paper-tooltip>
							product offering alteration price type
					</paper-tooltip>
				</div>
				<div>
					<paper-input id="sizeAlt3"
							class="size"
							name="size"
							label="[[i18n.unitSize]]"
							type="text"
							allowed-pattern="[0-9kmg]"
							pattern="^[0-9]+[kmg]?$"
							auto-validate
							value=1
							onfocus="endDatePick.hide(); startDatePick.hide();">
					</paper-input>
					<paper-tooltip>
							product offering alteration size
					</paper-tooltip>
				</div>
				<div>
					<paper-dropdown-menu
							label="[[i18n.unit]]">
						<paper-listbox
								id="addUnitDrop"
								on-selected-item-changed="checkPatternAlt"
								slot="dropdown-content"
								class="dropdown-content">
								<paper-item id="altBytes">
									Bytes
								</paper-item>
								<paper-item id="altCents">
									Cents
								</paper-item>
								<paper-item id="altSeconds">
									Seconds
								</paper-item>
						</paper-listbox>
					</paper-dropdown-menu>
					<paper-tooltip>
							product offering alteration units
					</paper-tooltip>
				</div>
				<div>
					<paper-input id="amountAlt3"
							class="amount"
							name="amount"
							label="[[i18n.amount]]"
							type="number"
							value=0
							onfocus="endDatePick.hide(); startDatePick.hide();">
					</paper-input>
					<paper-tooltip>
							product offering alteration amount
					</paper-tooltip>
				</div>
				<div>
					<paper-input id="addAltCurr"
							class="currency"
							name="currency"
							label="[[i18n.currency]]"
							onfocus="endDatePick.hide(); startDatePick.hide();">
					</paper-input>
					<paper-tooltip>
							product offering alteration currency
					</paper-tooltip>
				</div>
				<div>
					<paper-dropdown-menu id="addalt5drop"
							label="[[i18n.period]]"
							onfocus="endDatePick.hide(); startDatePick.hide();">
						<paper-listbox
								id="addaltPeriod"
								slot="dropdown-content"
								class="dropdown-content"
								selected="2">
							<paper-item>
								Daily
							</paper-item>
							<paper-item>
								Weekly
							</paper-item>
							<paper-item>
								Monthly
							</paper-item>
							<paper-item>
								Yearly
							</paper-item>
						</paper-listbox>
					</paper-dropdown-menu>
					<paper-tooltip>
							product offering alteration period
					</paper-tooltip>
				</div>
				<div class="buttons">
					<paper-button raised
							class="add-button"
							on-tap="addAlteration">
							<i18n-msg msgid="add">
								Add
							<i18n-msg>
					</paper-button>
					<paper-button dialog-dismiss
							class="cancel-button"
							onclick="addProductModal.close()">
							<i18n-msg msgid="cancel">
								cancel
							</i18n-msg>
					</paper-button>
				</div>
			</div>
				<div id="response-display-containe">
					<paper-toast id="toastErrorPri">
						<h2>Error</h2>
						<h5>Fill mandatory columns</h5>
						<ul>
							<li>Fill mandatory columns</li>
						</ul>
						<div class="close">
							<paper-button id="toastErrorClosePri"
								on-tap="toastErrorCloseBut()">
									Close
								</paper-button>
						</div>
					</paper-toast>
				</div>
			<paper-toast id="toast-successPrice">
				<h2>[[i18n.subToastSucPro]]</h2>
			</paper-toast>
		</paper-dialog>
		<iron-ajax
				id="productAddAjax"
				url="/catalogManagement/v1/productOffering"
				method = "POST"
				content-type="application/json"
				on-loading-changed="_onLoadingChanged"
				on-response="productAddResponse"
				handle-as="json">
		</iron-ajax>
	</template>
	<script>
		Polymer ({
			is: 'sig-pro-add',
			behaviors: [i18nMsgBehavior],
			properties: {
				alterations: {
					type: Array,
					value: function() {
						return [];
					}
				},
				prices: {
					type: Array,
					value: function() {
						return [];
					}
				},
				selected: {
					type: Number,
					value: 0
				},
				startdate: {
					type: String,
					value: ""
				},
				startDateOffer: {
					type: String,
					value: ""
				},
				startDatePrice: {
					type: String,
					value: ""
				},
				enddate: {
					type: String,
					value: ""
				},
				endDateOffer: {
					type: String,
					value: ""
				},
				endDatePrice: {
					type: String,
					value: ""
				},
				pickstart: {
					observer: 'pickStartDate'
				},
				pickend: {
					observer: 'pickEndDate'
				},
			},
			pickStartDate: function(date) {
				if (this.$.startDatePick.opened) {
					var m = moment(date);
					this.startdate = m.format('YYYY-MM-DD'); 
				} else if (this.$.startDatePickOff.opened) {
					var m = moment(date);
					this.startDateOffer = m.format('YYYY-MM-DD');
				} else if (this.$.startDatePickPrice.opened) {
					var p = moment(date);
					this.startDatePrice = p.format('YYYY-MM-DD');
				}
			},
			pickEndDate: function(date) {
				if (this.$.endDatePick.opened) {
					var m = moment(date);
					this.enddate = m.format('YYYY-MM-DD');
				} else if (this.$.endDatePickOff.opened) {
					var m = moment(date);
					this.endDateOffer = m.format('YYYY-MM-DD'); 
				} else if (this.$.endDatePickPrice.opened) {
					var p = moment(date);
					this.endDatePrice = p.format('YYYY-MM-DD');
				}
			},
			updatePriceDialog: function() {
				function checkPriceName(price) {
					return price.name == this.priceName.value; 
				}
				var indexPrice = this.prices.findIndex(checkPriceName);
				if (indexPrice == -1) {
					this.$.addPriceDes.value = null;
					this.$.addPrice1.value = null;
					this.$.addPriceSize.value = null;
					this.$.addPrice3.value = null;
				} else {
					this.$.addPriceDes.value = this.prices[indexPrice].description;
					this.$.priceStartDate.value = this.prices[indexPrice].start;
					this.$.priceEndDate.value = this.prices[indexPrice].end;
					this.$.addPrice1.value = this.prices[indexPrice].type;
					this.$.addPrice2.value = this.prices[indexPrice].unit;
					this.$.addPriceSize.value = this.prices[indexPrice].size;
					this.$.addPrice3.value = this.prices[indexPrice].amount;
				}
			},
			updateAltsDialog: function() {
				function checkName(alts) {
					return alts.name == this.addAlt1.value; 
				}
				var index = this.alterations.findIndex(checkName);
				if (index == -1) {
					this.$.descAlt2.value = null;
					this.$.typeAlt3.value = null;
					this.$.sizeAlt3.value = null;
					this.$.amountAlt3.value = null;
				} else {
					this.$.descAlt2.value = this.alterations[index].description;
					this.$.startAlt2.value = this.alterations[index].startdate;
					this.$.endAlt2.value = this.alterations[index].terminationDate;
					this.$.typeAlt3.value = this.alterations[index].type;
					this.$.addUnitDrop.value = this.alterations[index].units;
					this.$.sizeAlt3.value = this.alterations[index].size;
					this.$.amountAlt3.value = this.alterations[index].amount;
				}
			},
			addOffer: function() {
				var offerNew = new Object();
				if(this.$.addOff1.value != null && this.$.addOff1.value != "") {
					offerNew.name = this.$.addOff1.value;
				}
				if(this.$.addOff2.value != null && this.$.addOff2.value != "") {
					offerNew.description = this.$.addOff2.value;
				}
				var startDateTime;
				var endDateTime;
				if(this.$.addOff3.value != null && this.$.addOff3.value != "") {
					startDateTime = this.$.addOff3.value;
				}
				if(this.$.addOff4.value != null && this.$.addOff4.value != "") {
					endDateTime = this.$.addOff4.value;
				}
				if(startDateTime != null && endDateTime != null) {
					offerNew.validFor = {startDateTime, endDateTime};
				} else if(startDateTime != null && endDateTime == null) {
					offerNew.validFor = {startDateTime};
				} else if(startDateTime == null && endDateTime != null) {
					offerNew.validFor = {endDateTime};
				}
				function mapPrice(item) {
					var out = new Object();
					if(item.name != null && item.name != "") {
						out.name = item.name;
					}
					if(item.description != null && item.description != "") {
						out.description = item.description;
					}
					var startDateTime;
					var endDateTime;
					if(item.start != null && item.start != "") {
						startDateTime = item.start;
					}
					if(item.end != null && item.end != "") {
						endDateTime = item.end;
					}
					if(startDateTime != null && endDateTime != null) {
						out.validFor = {startDateTime, endDateTime};
					} else if(startDateTime != null && endDateTime == null) {
						out.validFor = {startDateTime};
					} else if(startDateTime == null && endDateTime != null) {
						out.validFor = {endDateTime};
					}
					if(item.type != null && item.type != "") {
						out.priceType = item.type;
					}
					if(item.unit != null && item.unit != ""
							&& item.size != null
							&& item.size != "") {
						var len = item.size.length; 
						var m = item.size.charAt(len - 1);
						var s = item.size.slice(0, (len - 1));
						if(item.unit == "b") {
							if (m == "m") {
								out.unitOfMeasure = s + "000000b";
							} else if(m == "g") {
								out.unitOfMeasure = s + "000000000b";
							} else if(m == "k") {
								out.unitOfMeasure = s + "000b";
							} else {
								out.unitOfMeasure = item.size;
							}
						} else if(item.unit == "c"){
							out.unitOfMeasure = item.size + "c";
						} else if(item.unit == "s") {
							var n = Number(s);
							if(m == "m") {
								n = n * 60;
								out.unitOfMeasure = n.toString();
							} else if(m == "h") {
								n = n * 3600;
								out.unitOfMeasure = n.toString();
							} else {
								out.unitOfMeasure = item.size;
							}
						}
					}
					var taxIncludedAmount;
					var currencyCode;
					if(item.amount != null && item.amount != "") {
						taxIncludedAmount = item.amount;
					}
					if(item.currency != null && item.currency != "") {
						currencyCode = item.currency;
					}
					if(taxIncludedAmount != null && currencyCode != null) {
						out.price = {taxIncludedAmount, currencyCode};
					} else if (taxIncludedAmount != null && currencyCode == null) {
						out.price = {taxIncludedAmount};
					} else if (taxIncludedAmount == null && currencyCode != null) {
						out.price = {currencyCode};
					}
					if(item.period != null && item.period != "") {
						out.recurringChargePeriod = item.period;
					}
					if(item.alterations != null && item.alterations != "") {
						out.productOfferPriceAlteration = new Object(); 
						if(item.alterations.name != null 
								&& item.alterations.name != "") {
							out.productOfferPriceAlteration.name = item.alterations.name;
						}
						if (item.alterations.description != null
								&& item.alterations.description != "") {
							out.productOfferPriceAlteration.description = item.alterations.description;
						}
						var startDateTime;
						var endDateTime;
						if (item.alterations.startdate != null
								&& item.alterations.startdate != "") {
							startDateTime = item.alterations.startdate;
						}
						if (item.alterations.terminationDate != null
								&& item.alterations.terminationDate != "") {
							endDateTime = item.alterations.terminationDate;
						}
						if (startDateTime != null && endDateTime != null) {
							out.productOfferPriceAlteration.validFor = {startDateTime, endDateTime}
						} else if(startDateTime != null && endDateTime == null) {
							out.productOfferPriceAlteration.validFor = {startDateTime};
						} else if(startDateTime == null && endDateTime != null) {
							out.productOfferPriceAlteration.validFor = {endDateTime};
						}
						if (item.alterations.type != null
								&& item.alterations.type != "") {
							out.productOfferPriceAlteration.priceType = item.alterations.type;
						}
						if (item.alterations.unit != null && item.alterations.unit != ""
								&& item.alterations.size != null && item.alterations.size != "") {
							var len1 = item.alterations.size.length;
							var m1 = item.alterations.size.charAt(len - 1);
							var s1 = item.alterations.size.slice(0, (len - 1));
							if(item.alterations.unit == "b") {
								if (m1 == "m") {
									out.productOfferPriceAlteration.unitOfMeasure = s1 + "000000b";
								} else if(m1 == "g") {
									out.productOfferPriceAlteration.unitOfMeasure = s1 + "000000000b";
								} else if(m1 == "k") {
									out.productOfferPriceAlteration.unitOfMeasure = s1 + "000b";
								} else {
									out.productOfferPriceAlteration.unitOfMeasure = item.alterations.size;
								}
							} else if(item.alterations.unit == "c"){
								out.alterations.unitOfMeasure = item.size + "c";
							} else if(item.alterations.unit == "s") {
								var n1 = Number(s1);
								if(m1 == "m") {
									n1 = n1 * 60;
									out.productOfferPriceAlteration.unitOfMeasure = n1.toString();
								} else if(m1 == "h") {
									n1 = n1 * 3600;
									out.productOfferPriceAlteration.unitOfMeasure = n1.toString();
								} else {
									out.productOfferPriceAlterationunitOfMeasure = item.alterations.size;
								}
							}
						}
						var taxIncludedAmount;
						var currencyCode
						if (item.alterations.amount != null
								&& item.alterations.amount != "") {
							taxIncludedAmount = item.alterations.amount;
						}
						if (item.alterations.currency != null
								&& item.alterations.currency != "") {
							currencyCode = item.alterations.currency;
						}
						if(taxIncludedAmount != null && currencyCode != null) {
							out.productOfferPriceAlteration.price = {taxIncludedAmount, currencyCode};
						} else if (taxIncludedAmount != null && currencyCode == null) {
							out.productOfferPriceAlteration.price = {taxIncludedAmount};
						} else if (taxIncludedAmount == null && currencyCode != null) {
							out.productOfferPriceAlteration.price = {currencyCode};
						}
						if (item.alterations.period != null
								&& item.alterations.period != "") {
							out.productOfferPriceAlteration.recurringChargePeriod = item.alterations.period;
						}
					}
					return out; 
				}
				offerNew.productOfferingPrice = this.prices.map(mapPrice);
				if(offerNew.name && offerNew.name !== null 
						&& offerNew.productOfferingPrice
						&& offerNew.productOfferingPrice.length > 0) {
					var ajax = this.$.productAddAjax;
					ajax.body = offerNew;
					ajax.generateRequest();
				}
			},
			checkPattern: function() {
				if(this.$.addPrice2.selected == 0) {
					this.$.addPriceSize.allowedPattern = "[0-9kmg]";
					this.$.addPriceSize.pattern = "^[0-9]+[kmg]?$";
				} else if(this.$.addPrice2.selected == 1) {
					this.$.addPriceSize.allowedPattern = "[0-9]";
					this.$.addPriceSize.pattern = "^[0-9]+$";
				} else if(this.$.addPrice2.selected == 2) {
					this.$.addPriceSize.allowedPattern = "[0-9mh]";
					this.$.addPriceSize.pattern = "^[0-9]+[mh]?$";
				}
			},
			checkPatternAlt: function() {
				if(this.$.addUnitDrop.selected == 0) {
					this.$.sizeAlt3.allowedPattern = "[0-9kmg]";
					this.$.sizeAlt3.pattern = "^[0-9]+[kmg]?$";
				} else if(this.$.addUnitDrop.selected == 1) {
					this.$.sizeAlt3.allowedPattern = "[0-9]";
					this.$.sizeAlt3.pattern = "^[0-9]+$";
				} else if(this.$.addUnitDrop.selected == 2) {
					this.$.sizeAlt3.allowedPattern = "[0-9mh]";
					this.$.sizeAlt3.pattern = "^[0-9]+[mh]?$";
				}
			},
			checkRecure: function() {
				if(this.$.addPrice1.selected == 0) {
					this.$.addPrice5drop.disabled = false;
					this.$.priceBytes.disabled = true;
					this.$.priceSeconds.disabled = true;
					this.$.priceCents.disabled = false;
				}else if(this.$.addPrice1.selected == 1) {
					this.$.addPrice5drop.disabled = true;
					this.$.priceBytes.disabled = true;
					this.$.priceSeconds.disabled = true;
					this.$.priceCents.disabled = false;
				}else if(this.$.addPrice1.selected == 2) {
					this.$.addPrice5drop.disabled = true;
					this.$.priceCents.disabled = true;
					this.$.priceBytes.disabled = false;
					this.$.priceSeconds.disabled = false;
				}
			},
			checkRecureAlt: function() {
				if(this.$.typeAlt3.selected == 0) {
					this.$.addalt5drop.disabled = false;
					this.$.altBytes.disabled = true;
					this.$.altSeconds.disabled = true;
					this.$.altCents.disabled = false;
				}else if(this.$.typeAlt3.selected == 1) {
					this.$.addalt5drop.disabled = true;
					this.$.altBytes.disabled = true;
					this.$.altSeconds.disabled = true;
					this.$.altCents.disabled = false;
				}else if(this.$.typeAlt3.selected == 2) {
					this.$.addalt5drop.disabled = true;
					this.$.altBytes.disabled = false;
					this.$.altSeconds.disabled = false;
					this.$.altCents.disabled = true;
				}
			},
			addPrice: function(event) {
				var priceNew = new Object();
				priceNew.name = this.$.priceName.value;
				priceNew.description = this.$.addPriceDes.value;
				priceNew.start = this.$.priceStartDate.value;
				priceNew.end = this.$.priceEndDate.value;
				switch(this.$.addPrice1.selected) {
					case 0:
						priceNew.type = "recurring";
						break;
					case 1:
						priceNew.type = "one_time";
						break;
					case 2:
						priceNew.type = "usage";
				}
				switch(this.$.addPrice2.selected) {
					case 0:
						priceNew.unit = "b";
						break;
					case 1:
						priceNew.unit = "c";
						break;
					case 2:
						priceNew.unit = "s";
				}
				priceNew.amount = parseInt(this.$.addPrice3.value);
				priceNew.size = this.$.addPriceSize.value;
				priceNew.currency = this.$.addPrice4.value;
				switch(this.$.addPrice5.selected) {
					case 0:
						priceNew.period = "daily";
						break;
					case 1:
						priceNew.period = "weekly";
						break;
					case 2:
						priceNew.period = "monthly";
						break
					case 3:
						priceNew.period = "yearly";
				}
				function checkAlt(alts) {
					return alts.name == this.addPriceDrop.value; 
				}
				var altIndex = this.alterations.findIndex(checkAlt);
				priceNew.alterations = this.alterations[altIndex];
				if(priceNew.name
						&& priceNew.name !== null
						&& priceNew.amount 
						&& priceNew.amount !== null 
						&& priceNew.type
						&& priceNew.type !== null
						&& priceNew.unit 
						&& priceNew.unit !== null) {
					this.push('prices', priceNew);
					document.getElementById("toast-successPri").open();
				} else {
					document.getElementById("toastErrorPri").open();
				}
				this.$.priceName.value = null;
				this.$.addPriceDes.value = null;
				this.$.priceStartDate.value = null;
				this.$.addPriceSize.value = null;
				this.$.addPrice3.value = null;
				this.$.addPrice2.value = null;
				this.$.priceEndDate.value = null;
				this.$.addPrice1.value = null;   
				this.$.addPrice4.value = null;
				this.$.addPrice5.value = null;
			},
			addAlteration: function() {
				var altNew = new Object();
				altNew.name = this.$.addAlt1.value;
				altNew.description = this.$.descAlt2.value;
				altNew.startdate = this.$.startAlt2.value;
				altNew.terminationDate = this.$.endAlt2.value;
				switch(this.$.typeAlt3.selected) {
					case 0:
						altNew.type = "recurring";
						break;
					case 1:
						altNew.type = "one_time";
						break;
					case 2:
						altNew.type = "usage";
				}
				switch(this.$.addUnitDrop.selected) {
					case 0:
						altNew.unit = "b";
						break;
					case 1:
						altNew.unit = "c";
						break
					case 2:
						altNew.unit = "s";
				}
				altNew.size = this.$.sizeAlt3.value;
				switch(this.$.addaltPeriod.selected) {
					case 0:
						altNew.period = "daily";
						break;
					case 1:
						altNew.period = "weekly";
						break;
					case 2:
						altNew.period = "monthly";
						break
					case 3:
						altNew.period = "yearly";
				}
				altNew.currency = this.$.addAltCurr.value;
				altNew.amount= parseInt(this.$.amountAlt3.value);
				if(altNew.name
						&& altNew.name !== null
						&& altNew.type
						&& altNew.type !== null
						&& altNew.unit
						&& altNew.unit !== null
						&& altNew.size
						&& altNew.size !== null
						&& altNew.amount
						&& altNew.amount !== null) {
					this.push('alterations', altNew);
				} else {
					console.log("toast error");
				}
				this.$.addAlt1.value = null
				this.$.descAlt2.value = null;
				this.$.startAlt2.value = null;
				this.$.addAltCurr.value = null;
				this.$.endAlt2.value = null;
				this.$.typeAlt3.value = null;
				this.$.sizeAlt3.value = null;
				this.$.amountAlt3.value = null;
			},
			_onLoadingChanged: function(event) {
				if (document.getElementById("productAddAjax").loading) {
					document.getElementById("progress").disabled = false;
				} else {
					document.getElementById("progress").disabled = true;
				}
			},
			productAddResponse: function(event) {
				this.$.addProductModal.close();
				this.$.addOff1.value = null;
				this.$.addOff2.value = null;
				this.prices.length = 0;
				this.alterations.length = 0;
				document.getElementById("getProducts").generateRequest();
			},
			toastErrorCloseBut: function(event) {
				var toast = document.getElementById("toastErrorPri");
				toast.close();
			}
		});
	</script>
</dom-module>
