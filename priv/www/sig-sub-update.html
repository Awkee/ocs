<link rel="import" href="polymer/polymer.html">
<link rel="import" href="i18n-msg/i18n-msg.html">
<link rel="import" href="i18n-msg/i18n-msg-behavior.html">
<link rel="import" href="paper-dialog/paper-dialog.html">
<link rel="import" href="paper-toolbar/paper-toolbar.html">
<link rel="import" href="paper-tabs/paper-tabs.html">
<link rel="import" href="paper-tooltip/paper-tooltip.html">
<link rel="import" href="paper-button/paper-button.html">
<link rel="import" href="paper-input/paper-input.html">
<link rel="import" href="paper-styles/color.html">
<link rel="import" href="iron-pages/iron-pages.html">
<link rel="import" href="iron-selector/iron-selector.html">
<link rel="import" href="iron-ajax/iron-ajax.html">

<dom-module id="sig-sub-update">
	<style is="custom-style">
		paper-dialog {
			overflow: auto;
		}
		paper-toolbar {
			margin-top: 0px;
			background-color: #bc5100;
		}
		paper-input {
			--paper-input-container-focus-color: var(--paper-yellow-900);
		}
		.toggle {
			display:inline-block;
		}
		.update-buttons {
			background: var(--paper-lime-a700);
			color: black;
		}
		.delete-buttons {
			background: #EF5350;
			color: black;
		}
		.cancel-btn {
			color: black;
		}
		paper-toggle-button {
			--paper-toggle-button-checked-bar-color: #ffb04c;
			--paper-toggle-button-checked-button-color: var(--paper-yellow-900);
		}
	</style>
	<template>
		<paper-dialog id="subUpdateModal" modal>
			<paper-toolbar>
				<paper-tabs selected="{{selected}}">
					<paper-tab id="authen">
						<h2>[[i18n.AuthTitle]]</h2>
					</paper-tab>
					<paper-tab id="autho">
						<h2>[[i18n.AuthorTitle]]</h2>
					</paper-tab>
					<paper-tab id="credit-up">
						<h2>[[i18n.credit]]</h2>
					</paper-tab>
				</paper-tabs>
			</paper-toolbar>
			<paper-tooltip for="authen">
				<i18n-msg msgid="AuthTooltip">
						Credentials used to authenticate subscriber.
				</i18n-msg>
			</paper-tooltip>
			<paper-tooltip for="autho">
				<i18n-msg msgid="AuthorTooltip">
						Services authorized for subscriber.
				</i18n-msg>
			</paper-tooltip>
			<iron-pages selected="{{selected}}">
				<div id="edit-password" >
					<paper-input id="edit-id1"
							name="id"
							label="[[i18n.identity]]"
							disabled>
					</paper-input>
					<paper-input id="edit-pwd"
							name="password"
							label="[[i18n.secret]]"
							disabled>
					</paper-input>
					<paper-input id="edit-new-pwd"
							name="newpassword"
							label="[[i18n.newpass]]"
							required
							auto-validate
							error-message="[[i18n.newpassError]]">
					</paper-input>
					<div class="buttons">
						<paper-button
								onclick="subUpdateModal.close()"
								class="cancel-btn">
							<i18n-msg msgid="cancel">
									Cancel
							</i18n-msg>
						</paper-button>
						<paper-button dialog-confirm
								autofocus
								on-click="updateSubAuthen"
								class="update-buttons">
							<i18n-msg msgid="update">
									Update
							</i18n-msg>
						</paper-button>
						<paper-button
								toggles
								raised
								on-click="deleteSub"
								class="delete-buttons">
							<i18n-msg msgid="delete">
									Delete
							</i18n-msg>
						</paper-button>
					</div>
				</div>
				<div id="edit-attributes">
					<div>
						<paper-input id="edit-recv-data-rate"
								name="ascendDataRate"
								type="number"
								label="[[i18n.recieve]]">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="dataRateTooltip">
									Limit on received (download) data per second in bits.
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="edit-trans-data-rate"
								name="ascendXmitRate"
								type="number"
								label="[[i18n.trans]]">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="xmitRateTooltip">
									Limit on transmitted (upload) data per second in bits.
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="edit-sess-timeout"
								name="sessionTimeout"
								type="number"
								label="[[i18n.ses]]">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="sessionTimeoutTooltip">
									Time between authorization requests in an active session in seconds
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="edit-update-interval"
								name="acctInterimInterval"
								type="number"
								label="[[i18n.accInt]]">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="intervalTooltip">
									Time between accouting interim updates in seconds.
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="edit-class"
								name="class"
								type="text"
								label="[[i18n.class]]" >
						</paper-input>
					</div></br>
						<i18n-msg msgid="enable">
								Enable
						</i18n-msg>
					<div class="toggle">
						<paper-toggle-button id="edit-enabled">
						</paper-toggle-button>
						<paper-tooltip>
							<i18n-msg msgid="intervalTooltip">
									Enabled for service or temporarily disabled.
							</i18n-msg>
						</paper-tooltip>
					</div>
						<i18n-msg msgid="multi">
								Multisession
						</i18n-msg>
					<div class="toggle">
						<paper-toggle-button id="edit-multi-session">
						</paper-toggle-button>
					</div><br>
					<div class="buttons">
						<paper-button
								onclick="subUpdateModal.close()"
								class="cancel-btn">
							<i18n-msg msgid="cancel">
									Cancel
							</i18n-msg>
						</paper-button>
						<paper-button dialog-confirm
								autofocus
								on-click="updateSubAutho"
								class="update-buttons">
							<i18n-msg msgid="update">
									Update
							</i18n-msg>
						</paper-button>
						<paper-button
								toggles
								raised
								on-click="deleteSub"
								class="delete-buttons">
							<i18n-msg msgid="delete">
									Delete
							</i18n-msg>
						</paper-button>
					</div>
				</div>
				<div id="edit-bal">
					<div>
						<paper-input id="edit-amount"
								name="amount"
								type="number"
								label="[[i18n.amount]]">
						</paper-input>
						<paper-dropdown-menu
								id="updateUni"
								label="[[i18n.unit]]">
							<paper-listbox
									slot="dropdown-content"
									class="dropdown-content"
									selected="0">
								<paper-item value="octets">
									<i18n-msg msgid="octet">
											octets
									</i18n-msg>
								</paper-item>
								<paper-item value="cents">
									<i18n-msg msgid="cent">
										cents
									</i18n-msg>
								</paper-item>
								<paper-item value="seconds">
									<i18n-msg msgid="second">
										seconds
									</i18n-msg>
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-input id="updatePro"
								name="product"
								label="[[i18n.prod]]">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="balTooltip">
									Credit value, against which accounting will debit usage against.
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div class="buttons">
						<paper-button dialog-dismiss
								onclick="subUpdateModal.close()"
								class="cancel-btn">
							<i18n-msg msgid="cancel">
									Cancel
							</i18n-msg>
						</paper-button>
						<paper-button dialog-confirm
								autofocus
								on-click="updateSubBal"
								class="update-buttons">
							<i18n-msg msgid="update">
									Update
							</i18n-msg>
						</paper-button>
						<paper-button
								toggles
								raised
								on-click="deleteSub"
								class="delete-buttons">
							<i18n-msg msgid="delete">
									Delete
							</i18n-msg>
						</paper-button>
					</div>
				</div>
			</iron-pages>
		</paper-dialog>
		<iron-ajax id="updateSubAuthen"
				content-type="application/json-patch+json"
				method="PATCH"
				on-response="updateSubAuthenResponse">
		</iron-ajax>
		<iron-ajax id="updateSubAutho"
				content-type="application/json"
				method="PATCH"
				on-response="updateSubAuthoResponse">
		</iron-ajax>
		<iron-ajax id="updateSubBal"
				content-type="application/json-patch+json"
				method="PATCH"
				on-response="updateSubBalResponse">
		</iron-ajax>
		<iron-ajax id="deleteSub"
				handle-as="json"
				on-response="deleteSubResponse">
		</iron-ajax>
	</template>
	<script>
		Polymer ({
			is: 'sig-sub-update',
			behaviors: [i18nMsgBehavior],
			properties: {
				selected: {
					type: Number,
					value: 0
				}
			},

			updateSubAuthen: function(event) {
				var editAjax =  document.getElementById("updateSubAuthen");
				var id = document.getElementById("edit-id1").value;
				editAjax.url = "/ocs/v1/subscriber/" + id;
				var sub = new Object();
				sub.op = "replace";
				sub.path = "/password";
				sub.value = document.getElementById("edit-new-pwd").value;
				editAjax.body = [sub];
				editAjax.generateRequest();
			},
			updateSubAuthenResponse: function (event) {
				if(event.detail.succeeded) {
					document.getElementById("edit-toast").open();
					document.getElementById("edit-new-pwd").value = "";
					document.getElementById("getSubs").generateRequest();
				} else {
					console.log("Not Success");
				}
			},
			updateSubBal: function(event) {
				var editAjax =  document.getElementById("updateSubBal");
				var id = document.getElementById("edit-id1").value;
				editAjax.url = "/ocs/v1/subscriber/" + id;
				var sub = new Object();
				sub.op = "add";
				sub.path = "/buckets/-";
				var totalBal = {"amount": parseInt(document.getElementById("edit-amount").value)};
				totalBal.units = document.getElementById("updateUni").value;
				totalBal.product = document.getElementById("updatePro").value;
				sub.value = totalBal;
				editAjax.body = [sub];
				editAjax.generateRequest();
			},
			updateSubBalResponse: function (event) {
				if(event.detail.succeeded) {
					document.getElementById("edit-toast").open();
					document.getElementById("getSubs").generateRequest();
				} else {
					console.log("Not Success");
				}
			},
			updateSubAutho: function(event) {
				var editAjax =  document.getElementById("updateSubAutho");
				var id = document.getElementById("edit-id1").value;
				editAjax.url = "/ocs/v1/subscriber/" + id;
				var sub1 = new Object();
				sub1.op = "replace";
				sub1.path = "/attributes";
				var attr = new Array();
				var ascendDataRate = new Object();
				ascendDataRate.name = "ascendDataRate";
				ascendDataRate.value = parseInt(document.getElementById("edit-recv-data-rate").value);
				attr[0] = ascendDataRate;
				var ascendXmitRate = new Object();
				ascendXmitRate.name = "ascendXmitRate";
				ascendXmitRate.value = parseInt(document.getElementById("edit-trans-data-rate").value);
				attr[1] = ascendXmitRate;
				var sessionTimeout = new Object();
				sessionTimeout.name = "sessionTimeout";
				sessionTimeout.value = parseInt(document.getElementById("edit-sess-timeout").value);
				attr[2] = sessionTimeout;
				var acctInterimInterval = new Object();
				acctInterimInterval.name = "acctInterimInterval";
				acctInterimInterval.value = parseInt(document.getElementById("edit-update-interval").value);
				attr[3] = acctInterimInterval;
				var classx = new Object();
				classx.name = "class";
				if(document.getElementById("edit-class").value == undefined) {
					classx.value = null;
				} else {
					classx.value = document.getElementById("edit-class").value;
				}
				attr[4] = classx;
				sub1.value = attr;
				var ena = new Object();
				ena.op = "replace";
				ena.path = "/enabled";
				ena.value = document.getElementById("edit-enabled").checked;
				var multi = new Object();
				multi.op = "replace";
				multi.path = "/multisession";
				multi.value= document.getElementById("edit-multi-session").checked;
				var subAttr = [sub1, ena, multi];
				editAjax.body = subAttr;
				editAjax.generateRequest();
			},
			updateSubAuthoResponse: function (event) {
				if(event.detail.succeeded) {
					document.getElementById("edit-toast").open();
					document.getElementById("getSubs").generateRequest();
				} else {
					console.log("Not Success");
				}
			},
			deleteSub: function(event) {
				var grid = document.getElementById("subscriberGrid");
				var selection = grid.selectedItems[0];
				var deleteAjax = document.getElementById("deleteSub");
				deleteAjax.method = "DELETE";
				deleteAjax.url = "/ocs/v1/subscriber/" + selection.id;
				deleteAjax.generateRequest();
			},
			deleteSubResponse: function(event) {
				document.getElementById("subUpdateModal").close();
				document.getElementById("delete-toast").open();
				document.getElementById("getSubs").generateRequest();
			}
		});
	</script>
</dom-module>
